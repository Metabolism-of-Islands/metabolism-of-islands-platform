{% extends "_base.html" %}
{% load moc_extras %}
{% load humanize %}
{% block page_name %}staf verify{% endblock %}

{% block content %}

{% include "hub/_nav.html" %}

  <section class="row">
    <div class="col-lg-8 mb-4 mb-lg-0">

      <div class="card mb-3">
        <div class="card-header"><i class="fa fa-info-circle"></i> Meta data</div>
        <div class="card-body">
          <a href="edit/?next={{ request.get_full_path }}" class="btn btn-primary-outline float-right"><i class="fa fa-pencil"></i> Edit</a>
          <dl class="row">
            <dt class="col-sm-3">Title</dt>
            <dd class="col-sm-9">
              {% with link=PROJECT.slug|add:":library_item" %}
                <a href="{% url link info.id %}">{{ info }}</a>
              {% endwith %}
            </dd>
            <dt class="col-sm-3">Description</dt>
            <dd class="col-sm-9">{{ info.get_description }}</dd>
            <dt class="col-sm-3">Year published</dt>
            <dd class="col-sm-9">{{ info.year }}</dd>
            <dt class="col-sm-3">Author(s)</dt>
            <dd class="col-sm-9">{{ info.get_author_citation }}</dd>
            <dt class="col-sm-3">Tag(s)</dt>
            <dd class="col-sm-9">
              {% for each in info.tags.all %}
                <span class="badge">{{ each }}</span>
              {% endfor %}
            </dd>
            <dt class="col-sm-3">File(s)</dt>
            <dd class="col-sm-9">
              {% for each in info.attachments.all %}
                <span class="badge"><a href="{{ each.file.url }}">{{ each }}</a> ({{ each.file.size|filesizeformat }})</span>
              {% endfor %}
            </dd>
          </dl>
        </div>
      </div>

      <div class="card card-table">
        <div class="card-header"><i class="fa fa-table"></i> Table content - preview</div>
        <div class="card-body">
          <div class="row">
            <div class="col-3">
              <ul class="list-unstyled">
                {% for each in header %}
                  <li style="height:1.5em;overflow:hidden;font-weight:bold" class="text-right">
                    {{ each }}
                  </li>
                {% endfor %}
              </ul>
            </div>
            <div class="col-9">
              <ul class="list-unstyled">
                {% for each in first_row %}
                  <li style="height:1.5em;overflow:hidden;opacity:0.5">
                    {{ each }}
                  </li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      </div>

      {% if document.comments %}
        <div class="card mb-2">
          <div class="card-header">
            Uploader comments
          </div>
          <div class="card-body">
            {{ document.comments|linebreaks }}
          </div>
        </div>
      {% endif %}

      <h2 class="h3 mt-5">Discussion and questions</h2>
      {% include "_messages.html" %}

      {% if not request.user.is_authenticated %}
        {% include "_notauthenticated.html" %}
      {% endif %}

    </div>

    <div class="col-lg-4">

      <div class="mb-3">
        <div title="Check general info" class="avatar letter" style="background:#218838">1</div>
        <div title="Classify columns" class="avatar letter">2</div>
        <div title="Verify data" class="avatar letter">3</div>
      </div>

      <div class="card mb-4">

        <ul class="list-group list-group-flush">
          <li class="list-group-item table-item">
            <div><i class="fal fa-fw fa-fingerprint mr-1"></i> ID</div>
            <div>{{ info.id }}</div>
          </li>
          <li class="list-group-item table-item">
            <div><i class="fal fa-fw fa-user mr-1"></i> Uploaded by</div>
            <div>{{ info.uploader }}</div>
          </li>
          <li class="list-group-item table-item">
            <div><i class="fal fa-fw fa-layer-group mr-1"></i> Columns</div>
            <div>{{ column_count }}</div>
          </li>
          <li class="list-group-item table-item">
            <div><i class="far fa-fw fa-table mr-1"></i> Rows</div>
            <div>{{ row_count }}</div>
          </li>
          {% if work.assigned_to %}
            <li class="list-group-item table-item">
              <div><i class="far fa-fw fa-user-check mr-1"></i> Assigned to</div>
              <div>{{ work.assigned_to }}</div>
            </li>
          {% endif %}
        </ul>
      </div>

      <form method="post">
        {% if not work.assigned_to %}
          <button type="submit" name="start_work" value="true" class="btn btn-primary">
            <i class="fas fa-user-plus"></i>
            Assign this to me
          </button>
        {% elif work.assigned_to == request.user.people %}

          <div class="mt-4 mb-5">
            {% if not error %}
            <a href="" class="btn btn-success disabled looks-good">
              It looks good <i class="fas fa-fw fa-arrow-right mr-0 ml-1"></i>
            </a>
            {% endif %}
          </div>

          <button type="submit" name="stop_work" value="true" class="btn btn-primary-outline mt-5">
            <i class="fas fa-user-times"></i>
            Stop working on this
          </button>
        {% endif %}
        {% csrf_token %}
      </form>

      <a href="https://www.youtube.com/watch?v=dQw4w9WgXcQ" target="_blank" class="btn btn-primary"><i class="fas fa-fw fa-play"></i> View instruction video</a>
      <a href="../" class="btn btn-primary-basic mt-4">
        <i class="fal fa-angle-left"></i>
        Back to overview
      </a>
    </div>

  </section>

{% endblock %}
