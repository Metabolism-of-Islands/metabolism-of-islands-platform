{% load static %}
<div class="top-layer">

  {% if BACK_LINK or PERMISSIONS or request.user.is_superuser %}
    <div class="return-bar">
      <div class="container">
        {% if BACK_LINK %}
          <a href="/"><i class="fad fa-arrow-circle-left"></i> Return to {{ SITE_NAME }}</a>
        {% endif %}

        {% if PERMISSIONS or request.user.is_superuser %}
          <div class="float-right">
            {% for each in PERMISSIONS %}
              <span class="badge badge-light">{{ each.relationship.name }}</span>
            {% endfor %}
            {% if request.user.is_superuser %}
              <span class="badge badge-light">Super user</span>
            {% endif %}
            <a class="badge badge-primary" href="{{ PROJECT.get_website }}controlpanel">
              <i class="fa fa-lock mr-1"></i>
              Control Panel
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  {% endif %}

  <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container">
      <a class="navbar-brand" href="{{ PROJECT.get_website }}">
        <img alt="{{ PROJECT }}" src="{{ LOGO }}">
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#project-navbar" aria-controls="project-navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="project-navbar">
        <ul class="navbar-nav ml-auto">

          {% if PROJECT.id == 4 %}
            {% include "_menu-multiplicity.html" %}
          {% elif PROJECT.id == 14 %}
            {% include "_menu-staf.html" %}
          {% elif PROJECT.id == 3 %}
            {% include "_menu-multimedia.html" %}
          {% elif PROJECT.id == 2 %}
            {% include "_menu-library.html" %}
          {% elif PROJECT.id == 8 %}
            {% include "_menu-ascus.html" %}
          {% elif PROJECT.id == 16 %}
            {% include "_menu-platformu.html" %}
          {% elif PROJECT.id == 18 %}
            {% include "_menu-community.html" %}
          {% else %}
            {% include "_menu-moc.html" %}
          {% endif %}

        </ul>
      </div>
    </div>
  </nav>

  {% if HEADER_STYLE == "full" %}
    <div class="jumbotron jumbotron-fluid text-light">
      <div class="container">
        {% if header_title %}
          <h1 class="display-4">{{ header_title }}</h1>
        {% endif %}
        {% if header_subtitle_link %}
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              &laquo; {{ header_subtitle_link|safe }}
            </ol>
          </nav>
        {% elif header_subtitle %}
            {{ header_subtitle|safe }}
        {% endif %}
      </div>
    </div>
  {% elif HEADER_STYLE == "image" %}
    <div class="img-header" style="background-image: url('{{ header_image }}')"></div>
  {% endif %}

</div>

{% if PROJECT.id == 4 and space %}
  <div {% if not dashboard %}id="img-city-wrapper" class="sticky-top"{% endif %}>
    <div id="img-city" {% if not dashboard %}class="smaller"{% endif %} style="background-image: url('{{ space.photo.image.url }}')">
      <div class="black-cover"></div>
      <div class="container">
        <div class="city-name">{{ space }}</div>
      </div>
    </div>
    <nav id="navbar-city" class="navbar navbar-light navbar-expand-md">
      <div class="container">
        <button class="navbar-toggler ml-3" type="button" data-toggle="collapse" data-target="#city-navbar" aria-controls="city-navbar" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="city-navbar">
          <ul class="navbar-nav mr-auto ml-3 ml-md-0">
            <li class="nav-item">
              <a class="nav-link pl-md-0" href="{% url 'data:dashboard' space.slug %}">Overview</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Sectors
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="{% url 'data:sector' space.slug 'agriculture' %}">Agriculture</a>
                <a class="dropdown-item" href="{% url 'data:sector' space.slug 'water' %}">Water</a>
                <a class="dropdown-item" href="{% url 'data:sector' space.slug 'waste' %}">Waste</a>
                <a class="dropdown-item" href="{% url 'data:sector' space.slug 'energy' %}">Energy</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">City Profile</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Resources
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                <a class="dropdown-item" href="{% url 'data:journal_articles' space.slug %}">Journal articles</a>
                <a class="dropdown-item" href="{% url 'data:reports' space.slug %}">Reports</a>
                <a class="dropdown-item" href="{% url 'data:theses' space.slug %}">Theses</a>
                <a class="dropdown-item" href="{% url 'data:photos' space.slug %}">Photos</a>
                <a class="dropdown-item" href="{% url 'data:maps' space.slug %}">Maps</a>
              </div>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Upload</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </div>
{% endif%}

{% if PROJECT.id == 4 and space %}
  <script>
    // add class when navbar becomes sticky - https://stackoverflow.com/a/57991537/1685643
    // get the sticky element
    const imgCityWrapper = document.getElementById("img-city-wrapper")

    const observer = new IntersectionObserver(
      ([e]) => e.target.classList.toggle("is-sticky", e.intersectionRatio < 1),
      {threshold: [1]}
    );

    observer.observe(imgCityWrapper)
  </script>
{% endif %}
