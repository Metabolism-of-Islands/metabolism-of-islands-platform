<div class="forum">
  {% if list_messages %}
    {% for each in list_messages %}
      <div class="single-message card mb-3">
        <div class="card-body">
          <div class="row metadata">
            <div class="col-6">
              <img src="{{ each.author.image.thumbnail.url }}" alt="" class="avatar plus" />
              {{ each.author }}
            </div>
            <div class="col-6 text-muted text-right avatar-line-height" title="{{ each.date_created|date:'l j F Y, H:i e' }}">
              <!-- {% if each.author == request.user.people %} -->
                <!-- <a href="edit/{{ each.id }}/"><i class="fa fa-pencil"></i></a> -->
              <!-- {% endif %} -->
              {{ each.date_created|timesince }} ago
            </div>
          </div>

          <hr>

          <div class="text">
            {% if each.name == "Task assigned" %}
              <i class="far fa-fw fa-user-check mx-1"></i>
            {% elif each.name == "Status change" %}
              <i class="far fa-fw fa-retweet mx-1"></i>
            {% elif each.name == "Task unassigned" %}
              <i class="far fa-fw fa-user-times mx-1"></i>
            {% elif each.name == "Task created" %}
              <i class="far fa-fw fa-play mx-1"></i>
            {% endif %}

            {{ each.get_description }}
          </div>

          {% if each.getForumMessageFiles %}
            <div class="attachment mt-3">
              {% for subeach in each.getForumMessageFiles %}
                <a class="btn btn-sm btn-primary-outline mb-1" href="{{ MEDIA_URL }}{{ subeach.file.url }}" target="_blank"><i class="far fa-paperclip"></i> {{ subdetails.getFileName }}
                </a>
              {% endfor %}
            </div>
          {% endif %}

        </div>
      </div>
    {% endfor %}
  {% endif %}
</div>

{% if request.user.is_authenticated %}

  {% if request.user.people in info.subscribers.all %}
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="unsubscribe" value="true" />
      <div class="text-right">
        You are subscribed to this thread
        <button class="btn btn-sm btn-outline-danger ml-3" type="submit">
          <i class="fal fa-ban"></i>
          Unsubscribe
        </button>
      </div>
    </form>

  {% endif %}

  <h3>{% if list_messages %}Reply{% elif message %}Edit message{% else %}Leave a comment{% endif %}</h3>
  <form method="post" enctype="multipart/form-data" {% if not message %}action="/forum/{% if forum_id %}{{ forum_id }}{% else %}{{ info.id }}{% endif %}/"{% endif %}>
    {% csrf_token %}
    <div class="form-group markdown-textarea">
      {% include "_markdown.html" %}
      <textarea class="form-control" id="text" name="text" rows="7" required>{{ message.description }}</textarea>
    </div>
    <div class="form-group" style="display:none">
      <label for="files"><i class="far fa-fw fa-paperclip"></i> File(s)</label>
      <div class="custom-file">
        <input type="file" class="custom-file-input" name="files" id="files" multiple="multiple">
        <label class="custom-file-label" for="files">Choose file</label>
      </div>
    </div>

    {% if show_subscribe %}
    <div class="form-check mb-4">
      <input class="form-check-input" type="checkbox" value="true" id="notify_me" name="subscribe" checked>
      <label class="form-check-label" for="notify_me">
        Notify me of updates
      </label>
    </div>
    {% endif %}

    <button type="submit" class="btn btn-success"><i class="fas fa-fw fa-comment-alt-plus"></i> Submit</button>
    <input type="hidden" name="return" value="{{ request.get_full_path }}" />
  </form>
{% endif %}
