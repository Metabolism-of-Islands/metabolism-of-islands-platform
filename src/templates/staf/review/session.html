{% extends "_base.html" %}
{% load moc_extras %}

{% block content %}

<div class="row">

  <div class="col-9">

    <ul class="nav nav-tabs mb-3">
      <li class="nav-item">
        <a class="nav-link active" href="#">Overview</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Data Classification</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Meta information</a>
      </li>
    </ul>

      <h2>{{ layer.name }}</h2>
      <h3>{{ layer.geom_type.name }}</h3>
      <h3>Fields: {{ layer.num_fields }}</h3>
      <h3>Features: {{ layer.num_feat }}</h3>
      <ul>
        {% for field in layer.fields %}
          <li>{{ field }}</li>
        {% endfor %}
      </ul>

      <pre>
      {{ layer.srs }}
      </pre>

      <table class="table table-striped">
        <tr>
          <th>Feature</th>
          <th>Property</th>
        </tr>
        <tr>
          <td>Coordinate reference system</td>
          <td>{{ layer.srs.DATUM }}</td>
        </tr>
        <tr>
          <td>PROJCS</td>
          <td>{{ layer.srs.PROJCS }}</td>
        </tr>
        <tr>
          <td>AUTHORITY</td>
          <td>{{ layer.srs.AUTHORITY }}</td>
        </tr>
        <tr>
          <td>SPHEROID</td>
          <td>{{ layer.srs.SPHEROID }}</td>
        </tr>
        <tr>
          <td>UNIT</td>
          <td>{{ layer.srs.UNIT }}</td>
        </tr>
        <tr>
          <td>PARAM</td>
          <td>{{ layer.srs.PARAMETER }}</td>
        </tr>
      </table>

      <table class="table table-striped datatable">
        <thead>
          <tr>
            {% for field in layer.fields %}
              <th>{{ field }}</th>
            {% endfor %}
          </tr>
          </thead>
          <tbody>
            {% for each in layer %}
              {% if forloop.counter <= 100 %}
                <tr>
                  {% for field in layer.fields %}
                    <td>{{ each|get_item:field }}</td>
                  {% endfor %}
                </tr>
              {% endif %}
            {% endfor %}
          </tbodY>
      </table>


    <div id="map" style="height:500px"></div>


  </div>

  <div class="col-3">

    <div class="card icon-card">
      <div class="icon">
        <i class="far fa-fw fa-info-circle" aria-hidden="true"></i>
      </div>
      <div class="card-body text-center">
        <p><strong>{{ session }}</strong><br>
        <code>{{ session.id }}</code></p>
        <p><strong>Uploader</strong><br> {{ session.uploader }}</p>
        <form method="post">
          <button type="submit" name="start_work" value="true" class="btn btn-success">Start working on this</button>
          {% csrf_token %}
        </form>

      </div>
    </div>

  </div>

</div>

{% endblock %}

{% block footer %}
  <script>
    // https://leafletjs.com/reference-1.6.0.html
    var map = L.map("map");
    L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={{ MAPBOX_API_KEY }}", {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
      id: "mapbox/streets-v11",
      tileSize: 512,
      zoomOffset: -1,
    }).addTo(map);

    geojsonlayer = L.geoJSON({{ geojson|safe }}, {
      style: {
        color: "#144d58",
        weight: 2,
      }
    }).addTo(map);

    map.fitBounds(geojsonlayer.getBounds());
  </script>
{% endblock %}
