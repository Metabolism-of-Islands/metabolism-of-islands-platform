{% extends "_base.html" %}
{% load static %}
{% block page_name %}dataset editor{% endblock %}
{% block title %}Dataset editor for Cape Town fish catch in 2013{% endblock %}

{% block head %}
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
        integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
        crossorigin=""/>
{% endblock %}

{% block content %}
  <h1 class="mb-0">Dataset editor</h1>
  <a href="#" class="btn btn-primary-basic mb-4">
    <i class="fal fa-angle-left"></i>
    Back to datasets
  </a>

  <section>
    <form id="dataset">
      <div class="row">
        <div class="col-md-6">
          <div class="form-group chart-types">
            <label class="category">Enabled chart types</label>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="column" checked>
              <label class="custom-control-label" for="column">Column</label>
            </div>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="bar" checked>
              <label class="custom-control-label" for="bar">Bar</label>
            </div>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="line">
              <label class="custom-control-label" for="line">Line</label>
            </div>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="pie" checked>
              <label class="custom-control-label" for="pie">Pie</label>
            </div>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="area">
              <label class="custom-control-label" for="area">Area</label>
            </div>
            <!-- these don't work with this dataset, switching to them makes the whole thing stop working and requires a page refresh
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="streamgraph">
              <label class="custom-control-label" for="streamgraph">Stream</label>
            </div>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="columnrange">
              <label class="custom-control-label" for="columnrange">Column range</label>
            </div>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="datetime">
              <label class="custom-control-label" for="datetime">Time series</label>
            </div>
             -->
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label class="category">Initial chart type</label>
            <select class="custom-select" id="initial-chart-type">
              <option value="column" selected>Column</option>
              <option value="bar">Bar</option>
              <option hidden value="line">Line</option>
              <option value="pie">Pie</option>
              <option hidden value="datetime">Time series</option>
              <option hidden value="area">Area</option>
              <option hidden value="streamgraph">Stream</option>
              <option hidden value="columnrange">Column range</option>
              <option hidden value="drilldown">Drilldown</option>
            </select>
          </div>

          <div class="form-group">
            <label class="category">Tooltip label</label>
            <input type="text" class="form-control" id="tooltip-label" value="Catch in 2013: <b>{point.y} tonnes</b>">
          </div>
        </div>
      </div>
      <div class="row mt-4">
        <div class="col-md-6">
          <div class="form-group">
            <label class="category">X-axis</label>

            <div class="form-group">
              <label>Type</label>
              <select class="custom-select" id="xaxis-type">
                <option value="linear">Linear</option>
                <option value="logarithmic">Logarithmic</option>
                <option value="datetime">Date / time</option>
                <option selected value="category">Category</option>
              </select>
            </div>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="xaxis-label">
              <label class="custom-control-label" for="xaxis-label">Label</label>
            </div>
            <div class="form-group xaxis-label-text" hidden>
              <input type="text" class="form-control" value="" placeholder="Label text">
            </div>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="xaxis-range">
              <label class="custom-control-label" for="xaxis-range">Custom range</label>
            </div>
            <div class="row xaxis-range-form" hidden>
              <div class="col">
                <input type="number" class="form-control" placeholder="Min" id="xaxis-min">
              </div>
              <div class="col">
                <input type="number" class="form-control" placeholder="Max" id="xaxis-max">
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label class="category">Y-axis</label>

            <div class="form-group">
              <label>Type</label>
              <select class="custom-select" id="yaxis-type">
                <option selected value="linear">Linear</option>
                <option value="logarithmic">Logarithmic</option>
                <option value="datetime">Date / time</option>
                <option value="category">Category</option>
              </select>
            </div>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="yaxis-label" checked>
              <label class="custom-control-label" for="yaxis-label">Label</label>
            </div>
            <div class="form-group yaxis-label-text">
              <input type="text" class="form-control" placeholder="Label text" value="Catch (in tonnes)">
            </div>
            <div class="custom-control custom-switch">
              <input type="checkbox" class="custom-control-input" id="yaxis-range">
              <label class="custom-control-label" for="yaxis-range">Custom range</label>
            </div>
            <div class="row yaxis-range-form" hidden>
              <div class="col">
                <input type="number" class="form-control" placeholder="Min" id="yaxis-min">
              </div>
              <div class="col">
                <input type="number" class="form-control" placeholder="Max" id="yaxis-max">
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="category">Color scheme</label>
        <div id="color-schemes" class="row">
          <div class="col-md-6 mb-3">
            <div class="single-scheme active" data-scheme="moc">
              <div class='row no-gutters'>
                <div class="col single-color" style="background-color: #144d58">&nbsp;</div>
                <div class="col single-color" style="background-color: #a6cee3">&nbsp;</div>
                <div class="col single-color" style="background-color: #33a02c">&nbsp;</div>
                <div class="col single-color" style="background-color: #b2df8a">&nbsp;</div>
                <div class="col single-color" style="background-color: #e31a1c">&nbsp;</div>
                <div class="col single-color" style="background-color: #fb9a99">&nbsp;</div>
                <div class="col single-color" style="background-color: #ff7f00">&nbsp;</div>
                <div class="col single-color" style="background-color: #fdbf6f">&nbsp;</div>
                <div class="col single-color" style="background-color: #6a3d9a">&nbsp;</div>
                <div class="col single-color" style="background-color: #cab2d6">&nbsp;</div>
                <div class="col single-color" style="background-color: #b15928">&nbsp;</div>
                <div class="col single-color" style="background-color: #ffff99">&nbsp;</div>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="single-scheme" data-scheme="dozen">
              <div class='row no-gutters'>
                <div class="col single-color" style="background-color: #8dd3c7">&nbsp;</div>
                <div class="col single-color" style="background-color: #ffffb3">&nbsp;</div>
                <div class="col single-color" style="background-color: #bebada">&nbsp;</div>
                <div class="col single-color" style="background-color: #fb8072">&nbsp;</div>
                <div class="col single-color" style="background-color: #80b1d3">&nbsp;</div>
                <div class="col single-color" style="background-color: #fdb462">&nbsp;</div>
                <div class="col single-color" style="background-color: #b3de69">&nbsp;</div>
                <div class="col single-color" style="background-color: #fccde5">&nbsp;</div>
                <div class="col single-color" style="background-color: #d9d9d9">&nbsp;</div>
                <div class="col single-color" style="background-color: #bc80bd">&nbsp;</div>
                <div class="col single-color" style="background-color: #ccebc5">&nbsp;</div>
                <div class="col single-color" style="background-color: #ffed6f">&nbsp;</div>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="single-scheme" data-scheme="pastel">
              <div class='row no-gutters'>
                <div class="col single-color" style="background-color: #fbb4ae">&nbsp;</div>
                <div class="col single-color" style="background-color: #b3cde3">&nbsp;</div>
                <div class="col single-color" style="background-color: #ccebc5">&nbsp;</div>
                <div class="col single-color" style="background-color: #decbe4">&nbsp;</div>
                <div class="col single-color" style="background-color: #fed9a6">&nbsp;</div>
                <div class="col single-color" style="background-color: #ffffcc">&nbsp;</div>
                <div class="col single-color" style="background-color: #e5d8bd">&nbsp;</div>
                <div class="col single-color" style="background-color: #fddaec">&nbsp;</div>
                <div class="col single-color" style="background-color: #f2f2f2">&nbsp;</div>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="single-scheme" data-scheme="set">
              <div class='row no-gutters'>
                <div class="col single-color" style="background-color: #e41a1c">&nbsp;</div>
                <div class="col single-color" style="background-color: #377eb8">&nbsp;</div>
                <div class="col single-color" style="background-color: #4daf4a">&nbsp;</div>
                <div class="col single-color" style="background-color: #984ea3">&nbsp;</div>
                <div class="col single-color" style="background-color: #ff7f00">&nbsp;</div>
                <div class="col single-color" style="background-color: #ffff33">&nbsp;</div>
                <div class="col single-color" style="background-color: #a65628">&nbsp;</div>
                <div class="col single-color" style="background-color: #f781bf">&nbsp;</div>
                <div class="col single-color" style="background-color: #999999">&nbsp;</div>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="single-scheme" data-scheme="accent">
              <div class='row no-gutters'>
                <div class="col single-color" style="background-color: #7fc97f">&nbsp;</div>
                <div class="col single-color" style="background-color: #beaed4">&nbsp;</div>
                <div class="col single-color" style="background-color: #fdc086">&nbsp;</div>
                <div class="col single-color" style="background-color: #ffff99">&nbsp;</div>
                <div class="col single-color" style="background-color: #386cb0">&nbsp;</div>
                <div class="col single-color" style="background-color: #f0027f">&nbsp;</div>
                <div class="col single-color" style="background-color: #bf5b17">&nbsp;</div>
                <div class="col single-color" style="background-color: #666666">&nbsp;</div>
              </div>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="single-scheme" data-scheme="dark">
              <div class='row no-gutters'>
                <div class="col single-color" style="background-color: #1b9e77">&nbsp;</div>
                <div class="col single-color" style="background-color: #d95f02">&nbsp;</div>
                <div class="col single-color" style="background-color: #7570b3">&nbsp;</div>
                <div class="col single-color" style="background-color: #e7298a">&nbsp;</div>
                <div class="col single-color" style="background-color: #66a61e">&nbsp;</div>
                <div class="col single-color" style="background-color: #e6ab02">&nbsp;</div>
                <div class="col single-color" style="background-color: #a6761d">&nbsp;</div>
                <div class="col single-color" style="background-color: #666666">&nbsp;</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label class="category">Other settings</label>
        <div class="custom-control custom-switch">
          <input type="checkbox" class="custom-control-input" id="data-labels">
          <label class="custom-control-label" for="data-labels">Data labels</label>
        </div>
        <div class="custom-control custom-switch">
          <input type="checkbox" class="custom-control-input" id="legend">
          <label class="custom-control-label" for="legend">Legend</label>
        </div>
        <div class="custom-control custom-switch">
          <input type="checkbox" class="custom-control-input" id="individual-colors">
          <label class="custom-control-label" for="individual-colors">Different color for each data point</label>
        </div>
      </div>
    </form>

    <button type="submit" class="btn btn-success" form="dataset">
      <i class="fas fa-fw fa-save"></i>
      Save dataset
    </button>

    <button class="btn btn-primary-basic btn-generate-preview">
      <i class="fal fa-fw fa-eye"></i>
      Generate preview
    </button>
  </section>

  <section id="preview">
    <h2>Preview</h2>
    <p>
      Below is what users will see when opening the dataset or when it's embedded in an article. Click on the generate preview button after you alter any settings to see your changes.
    </p>

    <div class="alert alert-primary">
      <i class="fal fa-info-circle mr-2"></i>
      For your convenience, the f tab is opened by default while in edit mode. When opened online it will open on the [INSERT TAB]
    </div>

    <div class="preview-wrap">
      <h3 class="preview-title">Cape Town fish catch in 2013</h3>
      <div class="preview-subtitle description mb-4">
        Aquatic agriculture catch from Cape Town in 2013, measured in tonnes
      </div>

      <div class="card">
        <div class="card-body">
          <div class="nav nav-pills nav-fill">
            <a class="nav-item nav-link" data-toggle="tab" href="#tab-chart">
              <i class="fal fa-fw fa-analytics mr-2"></i>
              Chart
            </a>
            <a class="nav-item nav-link tab-map active" data-toggle="tab" href="#tab-map">
              <i class="fal fa-fw fa-map-marked mr-2"></i>
              Map
            </a>
            <a class="nav-item nav-link" data-toggle="tab" href="#tab-quality">
              <i class="fal fa-fw fa-star mr-2"></i>
              Data quality
            </a>
            <a class="nav-item nav-link" data-toggle="tab" href="#tab-metadata">
              <i class="fal fa-fw fa-info-circle mr-2"></i>
              Metadata
            </a>
            <a class="nav-item nav-link load-data" data-toggle="tab" href="#tab-data">
              <i class="fal fa-fw fa-table mr-2"></i>
              Data
            </a>
            <a class="nav-item nav-link" data-toggle="tab" href="#tab-share">
              <i class="fal fa-fw fa-share-alt mr-2"></i>
              Share
            </a>
          </div>

          <hr class="tab-divider">

          <div class="tab-content">
            <!-- chart -->
            <div class="tab-pane" id="tab-chart">
              <div class="alert alert-light">
                <i class="fal fa-info-circle mr-3"></i>
                The chart was configured in the previous step. It will be visible in the preview after completing the map configuration
              </div>
            </div>

            <!-- map -->
            <div class="tab-pane active" id="tab-map">
              <div id="map"></div>
            </div>

            <!-- data quality -->
            <div class="tab-pane" id="tab-quality">
              <div class="row">
                <div class="col-lg-6">
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item table-item">
                      <div><i class="far fa-fw fa-star mr-1"></i> Reliability</div>
                      <div class="rating" data-rating="1">
                        <div class="number">1</div>
                        <div class="graph">
                          <span class="full"></span>
                          <span class="full"></span>
                          <span class="full"></span>
                          <span class="full"></span>
                          <span class="full"></span>
                        </div>
                      </div>
                    </li>
                    <li class="list-group-item table-item">
                      <div><i class="far fa-fw fa-box-full mr-1"></i> Completeness</div>
                      <div class="rating" data-rating="2">
                        <div class="number">2</div>
                        <div class="graph">
                          <span class=""></span>
                          <span class="full"></span>
                          <span class="full"></span>
                          <span class="full"></span>
                          <span class="full"></span>
                        </div>
                      </div>
                    </li>
                    <li class="list-group-item table-item">
                      <div><i class="far fa-fw fa-universal-access mr-1"></i> Access</div>
                      <div class="rating" data-rating="3">
                        <div class="number">3</div>
                        <div class="graph">
                          <span class=""></span>
                          <span class=""></span>
                          <span class="full"></span>
                          <span class="full"></span>
                          <span class="full"></span>
                        </div>
                      </div>
                    </li>
                    <li class="list-group-item table-item">
                      <div><i class="far fa-fw fa-map-marked-alt mr-1"></i> Geographical correlation</div>
                      <div class="rating" data-rating="4">
                        <div class="number">4</div>
                        <div class="graph">
                          <span class=""></span>
                          <span class=""></span>
                          <span class=""></span>
                          <span class="full"></span>
                          <span class="full"></span>
                        </div>
                      </div>
                    </li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <div class="alert alert-light">
                    <strong>Reliability</strong>
                    <p>
                      Fuga officiis illum eveniet. Voluptatem qui laudantium in iure amet. Nesciunt ut omnis atque iste voluptas natus. Inventore qui officiis consequatur culpa adipisci ea adipisci quaerat.
                    </p>

                    <strong>Completeness</strong>
                    <p>
                      Nisi inventore suscipit illo iure similique assumenda. Hic beatae nihil ullam. Quis et aut iure laudantium
                    </p>

                    <strong>Access</strong>
                    <p>
                      Quia sed ea eius voluptatem. Libero cum cum assumenda quia. Quas iste eius reprehenderit libero quam fugiat beatae.
                    </p>

                    <strong>Geographical correlation</strong>
                    <p>
                      Est vel officia enim facere fuga occaecati. Exercitationem voluptate facilis ut reprehenderit quia similique. Voluptatibus nihil quia quaerat ipsam dicta et.
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- metadata -->
            <div class="tab-pane" id="tab-metadata">
              <div class="row">
                <div class="col-lg-6">
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                      <i class="far fa-fw fa-map-marker-alt mr-1" aria-hidden="true"></i> Brussels, Belgium
                    </li>
                    <li class="list-group-item">
                      <i class="far fa-fw fa-calendar mr-1" aria-hidden="true"></i> 01 January 2012 - 31 December 2017
                    </li>
                    <li class="list-group-item">
                      <i class="far fa-fw fa-flask mb-1 mr-1" aria-hidden="true"></i> Materials
                      <br>
                      <a class="btn btn-sm btn-primary-outline mt-1" href="">Agricultural products</a>
                    </li>
                    <li class="list-group-item table-item">
                      <div><i class="far fa-fw fa-dot-circle mr-1"></i> Data points</div>
                      <div>13</div>
                    </li>
                    <li class="list-group-item table-item">
                      <div><i class="far fa-fw fa-database mr-1"></i> Source(s)</div>
                      <div><a href="https://metabolismofcities.org/resources/publications/851">Freight Transport</a></div>
                    </li>
                    <li class="list-group-item table-item">
                      <div><i class="far fa-fw fa-user mr-1"></i> Uploaded by</div>
                      <div><a href="">Fulano de Tal</a></div>
                    </li>
                    <li class="list-group-item table-item">
                      <div><i class="far fa-fw fa-calendar-day mr-1"></i> Upload date</div>
                      <div>12 March 2018</div>
                    </li>
                  </ul>
                </div>
                <div class="col-lg-6">
                  <div class="alert alert-light">
                    <strong>Replication</strong>
                    <ol>
                      <li>Enter the IBSA website http://ibsa.brussels</li>
                      <li>Go in Themes page</li>
                      <li>Go in Mobility and Transport page</li>
                      <li>Download the Freight Transport .xls file (available just in French)</li>
                    </ol>
                  </div>
                </div>
              </div>
            </div>

            <!-- data -->
            <div class="tab-pane" id="tab-data">
              <a class="btn btn-primary mb-4" href=""><i class="fas fa-download"></i> Download data</a>
              <a class="btn btn-primary-basic mb-4" href="">Report an error</a>

              <div class="table-wrapper">
                <div class="alert alert-light">
                  <h3 class="mb-0">
                    <i class="fal fa-spinner-third fa-spin mr-4"></i>
                    Loading table
                  </h3>
                </div>
              </div>
            </div>

            <!-- share -->
            <div class="tab-pane" id="tab-share">
              <div class="form-group">
                <input id="share-url" class="form-control" value="https://metabolismofcities.org/cities/the-hague/datasets/52/" readonly>
              </div>

              <button class="btn btn-primary copy-url">
                <i class="fas fa-copy"></i> Copy URL
              </button>
              <a class="btn btn-primary" href="">
                <i class="fab fa-linkedin"></i> LinkedIn
              </a>
              <a class="btn btn-primary" href="">
                <i class="fab fa-twitter"></i> Twitter
              </a>
              <a class="btn btn-primary" href="">
                <i class="fab fa-facebook-square"></i> Facebook
              </a>
              <a class="btn btn-primary" href="">
                <i class="fas fa-envelope"></i> E-mail
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <button type="submit" class="btn btn-success mt-4" form="dataset">
      <i class="fas fa-fw fa-save"></i>
      Save dataset
    </button>
  </section>
{% endblock %}

{% block footer %}
  <!-- load datatables -->
  <script src="{% static 'js/datatables.min.js' %}"></script>
  <script>
    // enable datatables
    $("table").DataTable();

    // copy url
    const copyUrlButton = $(".copy-url");

    copyUrlButton.click(function() {
      $("#share-url").select();
      document.execCommand("copy");

      copyUrlButton.html("<i class='fas fa-check'></i> Copied to clipboard");

      window.setTimeout(function() {
        copyUrlButton.html("<i class='fas fa-copy'></i> Copy URL");
      }, 3000);
    });
  </script>

  <!-- load leaflet -->
  <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
          integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
          crossorigin="">
  </script>

  <!-- sample data -->
  <script src="https://leafletjs.com/examples/choropleth/us-states.js"></script>

  <script>
    var map = L.map("map").setView([37.8, -96], 4);

    L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q", {
      maxZoom: 18,
      attribution: "Map data &copy; <a href='https://www.openstreetmap.org/'>OpenStreetMap</a> contributors, " +
        "<a href='https://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, " +
        "Imagery © <a href='https://www.mapbox.com/'>Mapbox</a>",
      id: "mapbox/light-v10",
      tileSize: 512,
      zoomOffset: -1,
    }).addTo(map);

    // get color depending on population density value
    function getColor(d) {
      return d > 1000 ? "#800026" :
             d > 500  ? "#BD0026" :
             d > 200  ? "#E31A1C" :
             d > 100  ? "#FC4E2A" :
             d > 50   ? "#FD8D3C" :
             d > 20   ? "#FEB24C" :
             d > 10   ? "#FED976" :
                        "#FFEDA0";
    }

    function style(feature) {
      return {
        weight: 1,
        opacity: 1,
        color: "white",
        fillOpacity: 0.7,
        fillColor: getColor(feature.properties.density)
      };
    }

    var choropleth = L.geoJson(statesData, {
      style: style,
    });

    var filteredLayer;

    function filterChoropleth(value) {
      map.removeLayer(window[visibleLayer]);

      let valueValue = value;

      filteredLayer = L.geoJson(statesData, {
        filter: function(feature, layer) {
          return feature.properties.density > valueValue;
        },
        style: style,
      });

      map.addLayer(filteredLayer);
      visibleLayer = "filteredLayer";
    }

    $("#filter-choropleth").click(function() {
      let value = $("input.choropleth-value").val()
      filterChoropleth(value);
    })


    var bubbles = L.circle([40,-100], {
        color: "red",
        fillColor: "#f03",
        fillOpacity: 0.5,
        radius: 500000,
    })

    var marker = L.marker([30,-90]);

    let visibleLayer = "choropleth";
    map.addLayer(window[visibleLayer]);

    $("#switch-layers").change(function() {
      let newLayer = $("#switch-layers").val();

      map.removeLayer(window[visibleLayer]);
      map.addLayer(window[newLayer]);

      visibleLayer = newLayer;
    })

    $(".download-map").click(function() {
      // leafletImage(map, downloadImage);
    })
  </script>
{% endblock %}