{% extends "_base.html" %}

{% block title %}My area{% endblock %}

{% block css %}
<style>
  label {
    font-weight: bold;
    margin-bottom: 0;
  }

  .custom-switch label {
    font-weight: normal;
  }

  .leaflet-map {
    height: 400px;
    width: 100%;
    box-shadow: none;
  }
</style>
{% endblock %}

{% block content %}

<h1 class="mb-4">My area</h1>

<section>
  <div class="row text-center">
    <div class="col-md">
      <h2>{{ organization_list|length }}</h2>
      organisations

      <div id="map" class="leaflet-map border my-4"></div>
    </div>
    <div class="col-md">
      <h2>{{ data|length }}</h2>
      data entries

      <div class="border my-4" id="chart"></div>
    </div>
  </div>
</section>

<form method="post" enctype="multipart/form-data">
  <div class="form-group">
    <label for="description">General information about the area</label>
    <textarea class="form-control" name="description" name="description" rows="3"></textarea>
  </div>

  <div class="form-group">
    <label for="period">Reporting period</label>
    <select id="period" class="custom-select">
      <option value="1">Yearly</option>
      <option value="2">Quarterly</option>
      <option value="3">Monthly</option>
      <option value="4">Weekly</option>
    </select>
  </div>

  <div class="form-group">
    <label>Available data types</label>
    <div class="custom-control custom-switch">
      <input type="checkbox" class="custom-control-input" id="resources" name="resources">
      <label class="custom-control-label" for="resources">Resources</label>
    </div>

    <div class="custom-control custom-switch">
      <input type="checkbox" class="custom-control-input" id="spaces" name="spaces">
      <label class="custom-control-label" for="spaces">Spaces</label>
    </div>

    <div class="custom-control custom-switch">
      <input type="checkbox" class="custom-control-input" id="technology" name="technology">
      <label class="custom-control-label" for="technology">Technology</label>
    </div>

    <div class="custom-control custom-switch">
      <input type="checkbox" class="custom-control-input" id="staff" name="staff">
      <label class="custom-control-label" for="staff">Staff</label>
    </div>
  </div>

  {% csrf_token %}
  <button type="submit" class="btn btn-primary"><i class="fa fa-save"></i> Save</button>
</form>

{% endblock %}

{% block footer %}
  <script>
    // leaflet map
    map.setView([50.85, 4.36], 11);

    {% for each in organization_list %}
      L.marker([{{ each.meta_data.lat }}, {{ each.meta_data.lng }}]).addTo(map);
    {% endfor %}


    // pie chart
    Highcharts.setOptions({
      colors: ["#016FB9", "000", "#AF316A", "gold"]
    });

    const defaultFont = "Lato, Helvetica Neue, Arial, Helvetica, sans-serif";


    Highcharts.chart("chart", {
      credits: {
        text: "Generated by PlatformU",
        href: null,
        style: {
          fontSize: "12px",
          cursor: "default",
        },
      },
      chart: {
        type: "pie",
        style: {
          fontFamily: defaultFont
        },
      },
      title: {
        text: "Types of entries"
      },
      tooltip: {
        pointFormat: "{series.name}: <b>{point.y}</b>"
      },
      accessibility: {
        point: {
          valueSuffix: '%'
        }
      },
      plotOptions: {
        pie: {
          dataLabels: {
            enabled: false
          },
          showInLegend: true
        }
      },
      series: [{
        name: "Number of entries",
        colorByPoint: true,
        data: [
          {
            name: "Resources",
            y: {{ resources_items|length }}
          },
          {
            name: "Space",
            y: {{ space_items|length }}
          },
          {
            name: "Technology",
            y: {{ technology_items|length }}
          },
          {
            name: "Staff",
            y: {{ staff_items|length }}
          },
        ]
      }]
    });
  </script>
{% endblock %}
