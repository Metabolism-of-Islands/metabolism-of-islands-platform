{% extends "_base.html" %}

{% block title %}Organistations' interconnectedness{% endblock %}

{% block css %}
<style>
  #connections {
    height: 700px;
    max-height: 90vh;
  }
</style>
{% endblock %}

{% block content %}

<h1>Organistations' interconnectedness</h1>

<section>
  <div id="connections" class="border"></div>
</section>

<section>
  <table class="table datatable bg-white">
    <thead>
      <tr>
        <th>Organisation A</th>
        <th>Organisation B</th>
        <th>Connection</th>
      </tr>
    </thead>
    <tbody>
      {% for each in connections %}
        <tr>
          <td><a href="{% url 'platformu:admin_entity' my_organization.id each.record_parent.id %}">{{ each.record_parent }}</a></td>
          <td><a href="{% url 'platformu:admin_entity' my_organization.id each.record_child.id %}">{{ each.record_child }}</a></td>
          <td>{{ each.meta_data.dependency }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</section>

{% endblock %}

{% block footer %}
<script src="https://code.highcharts.com/modules/networkgraph.js"></script>
<script>
  const defaultFont = "Lato, Helvetica Neue, Arial, Helvetica, sans-serif";

  Highcharts.setOptions({
    colors: ["#daeaf5"]
  });

  Highcharts.chart("connections", {
    credits: {
      text: "Generated by PlatformU",
      href: null,
      style: {
        fontSize: "12px",
        cursor: "default",
      },
    },
    plotOptions: {
      networkgraph: {
        layoutAlgorithm: {
          integration: "verlet",
        }
      },
      series: {
        states: {
          inactive: {
            linkOpacity: 0,
            opacity: 0,
          }
        },
        // cursor: "pointer",
        // point: {
        //   events: {
        //     click: function () {
        //       location.href = 'https://en.wikipedia.org/wiki/' + this.options.key;
        //     }
        //   }
        // },
      }
    },
    tooltip: false,
    exporting: {
      scale: 4,
    },
    chart: {
      type: "networkgraph",
      style: {
        fontFamily: defaultFont
      },
    },
    title: false,
    series: [{
      dataLabels: {
        enabled: true,
        linkFormat: "",
        padding: 10,
        style: {
          fontSize: "14px",
        },
      },
      states: {
        inactive: {
          linkOpacity: 0.01,
          opacity: 0.01,
        }
      },
      marker: {
        radius: 10,
        lineWidth: 2,
        lineColor: "#016FB9",
        states: {
          inactive: {
            linkOpacity: 0.01,
            opacity: 0.01,
          }
        },
      },
      data: [
        {% for each in connections %}
          {
            from: "{{ each.record_parent }}",
            to: "{{ each.record_child }}",
            className: "test",
            color: "#000",
            width: "{% if each.meta_data.dependency == 'Low' %}1{% elif each.meta_data.dependency == 'Medium' %}3{% elif each.meta_data.dependency == 'High' %}7{% endif %}",
          },
        {% endfor %}
      ]
    }]
  });
</script>
{% endblock %}