{% extends "_base.html" %}

{% block title %}Organistations' interconnectedness{% endblock %}

{% block css %}
<style>
</style>
{% endblock %}

{% block content %}

<h1>Organistations' interconnectedness</h1>

<div id="connections" class="border"></div>

<table class="table bg-white mt-4">
  <thead>
    <tr>
      <th colspan="2">Between</th>
      <th>Connection</th>
    </tr>
  </thead>
  <tbody>
    {% for each in connections %}
      <tr>
        <td><a href="{% url 'platformu:admin_entity' my_organization.id each.record_parent.id %}">{{ each.record_parent }}</a></td>
        <td><a href="{% url 'platformu:admin_entity' my_organization.id each.record_child.id %}">{{ each.record_child }}</a></td>
        <td>{{ each.meta_data.dependency }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}

{% block footer %}
<script src="https://code.highcharts.com/modules/networkgraph.js"></script>
<script>
  const defaultFont = "Lato, Helvetica Neue, Arial, Helvetica, sans-serif";

  Highcharts.setOptions({
    colors: ["#016FB9"]
  });

  Highcharts.chart("connections", {
    credits: {
      text: "Generated by PlatformU",
      href: null,
      style: {
        fontSize: "12px",
        cursor: "default",
      },
    },
    plotOptions: {
      networkgraph: {
        layoutAlgorithm: {
          integration: "verlet",
        }
      },
      series: {
        cursor: 'pointer',
        point: {
          events: {
            click: function () {
              location.href = 'https://en.wikipedia.org/wiki/' + this.options.key;
            }
          }
        }
      }
    },
    tooltip: false,
    exporting: {
      scale: 4,
    },
    chart: {
      type: "networkgraph",
      style: {
        fontFamily: defaultFont
      },
    },
    title: false,
    series: [{
      dataLabels: {
        enabled: true,
        linkFormat: "",
      },
      data: [
        {% for each in connections %}
          {
            from: "{{ each.record_parent }}",
            to: "{{ each.record_child }}",
            className: "test",
            color: "green",
            custom: "{% if each.meta_data.dependency == 'Low dependence' %}low{% elif each.meta_data.dependency == 'Medium' %}medium{% else %}high{% endif %}",
          },
        {% endfor %}
      ]
    }]
  });
</script>
{% endblock %}