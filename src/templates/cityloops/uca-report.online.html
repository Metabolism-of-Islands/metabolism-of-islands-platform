{% load static %}
{% load moc_extras %}
{% load sass_tags %}
{% load humanize %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>{{ space }} | Urban Circularity Assessment Report | CityLoops</title>

  <link class="favicon" rel="shortcut icon" sizes="126x126" href="{% static 'img/favicon/favicon.png' %}">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
     integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
     crossorigin=""/>
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-VhBcF/php0Z/P5ZxlxaEx1GwqTQVIBu4G4giRWxTKOCjTxsPFETUDdVL5B6vYvOt" crossorigin="anonymous">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <link href="{% sass_src 'css/main.scss' %}?refresh21-apr" rel="stylesheet" type="text/css" />
  <style>
    @import url(https://fonts.googleapis.com/css?family=Montserrat:400,700&subset=latin);

    body{
      background-color: #fff;
    }

    p {
      text-align: justify;
      text-justify: inter-word;
    }

    img {
      max-width: 100%;
      border-radius: .25rem;
    }

    .cover-page {
      position: relative;
    }

    .cover-title {
      color: #fff;
      padding: 90px;
      font-weight: bolder;
      text-transform: uppercase;
    }

    .report-title {
      background-color: #004d76;
      font-size: 1.75rem;
      padding: 8px;
      line-height: 3.5rem;
    }

    .city-title {
      background-color: #00b6ed;
      font-size: 2rem;
      padding: 8px;
      line-height: 4rem;
    }

    .pdf-links {
      position: absolute;
      left: 105px;
      bottom: 30px;
    }

    .cover-image {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      z-index: -1;
      object-fit: cover;
    }

    .col-logos {
      background: #fffd;
      padding: 90px 60px;
    }

    .context-map {
      height: 285px;
      width: 100%;
      border-radius: .25rem;
    }

    .report-content table {
      margin-bottom: 3rem;
    }

    .report-content > img {
      border-radius: .25rem;
    }

    label {
      font-weight: bold;
      margin-bottom: 0;
    }

    iframe {
      width: 100%;
      height: 500px;
      margin-bottom: 2rem;
    }

    #sankey {
      width: 100%;
    }

    .table th {
      background-color: #efefef !important;
    }

    .table td.bg-red {
      background-color: #B57272 !important;
    }

    .table td.bg-green {
      background-color: #87C291 !important;
    }

    .table td.bg-orange {
      background-color: #D9946C !important;
    }

    .table td.bg-blue {
      background-color: #b2c3ef !important;
    }

    .table td.bg-yellow {
      background-color: #e6d384 !important;
    }

    h1 {
      font-size: 1.75rem !important;
    }

    h2 {
      font-size: 1.5rem !important;
    }

    h3,
    h4 {
      font-size: 1.25rem !important;
    }

    .static-image {
      display: none;
    }
  </style>
</head>

<body>
  <div class="return-bar">
    <div class="container">
      <a href="{% url 'cityloops:index' %}">
        <i class="fad fa-arrow-circle-left mr-1"></i> Return to CityLoops Data Hub
      </a>
    </div>
  </div>

  <div class="container py-4">
    <div class="cover-page mb-4">
      <div class="row">
        <div class="col-9">
          <div class="cover-title">
            <span class="report-title">Urban Circularity Assessment</span>
            <br>
            <span class="city-title">{{ space }}</span>

          </div>
          <!--
          <div class="pdf-links">
            {% if sca_report_pdf_url %}
              <a class="btn btn-inverse rounded-0" href="{{ sca_report_pdf_url }}" target="_blank">
                <i class="fal fa-file-pdf"></i> PDF version
              </a>
            {% endif %}
            {% if sca_report_id %}
              <a class="btn btn-inverse rounded-0" href="{% url 'cityloops:library_item' sca_report_id %}" target="_blank">
                <i class="fal fa-info-circle"></i> Report's metadata
              </a>
            {% endif %}
          </div>
          -->
        </div>
        <div class="col-3 col-logos">
          <img class="img-fluid mb-4" src="https://metabolismofcities.org/media/records/CityLoops_Logo.png">
          <img class="img-fluid" src="https://i.imgur.com/ARgcRYc.png">
        </div>
      </div>
    </div>

    <div class="report-content">
      <section id="summary">
        <h1>Summary</h1>
      </section>

      <section id="introduction">
        <h1>Introduction</h1>
      </section>

      <section id="urban-context">
        <h1>Urban context</h1>

        <div class="row mb-3">
          <div class="col-3">
            <div class="context-map rounded" id="space-map"></div>
          </div>
          <div class="col-3">
            <div class="context-map rounded" id="nuts3-map"></div>
          </div>
          <div class="col-3">
            <div class="context-map rounded" id="nuts2-map"></div>
          </div>
          <div class="col-3">
            <div class="context-map rounded" id="country-map"></div>
          </div>
        </div>
        <div class="row mb-4">
          <div class="col-3">
            <strong>{{ space }}</strong>
            <div>
              <i class="fal fa-users fa-fw mr-2"></i>
              {% if report.space_population %}
                {{ report.space_population|intcomma }}
              {% else %}
                <span class="question-number bg-dark text-light rounded px-2 mr-2">1A</span>
              {% endif %}
            </div>
            <div>
              <i class="fal fa-ruler-combined fa-fw mr-2"></i>
              {% if report.space_size %}
                {{ report.space_size|intcomma }} km<sup>2</sup>
              {% else %}
                <span class="question-number bg-dark text-light rounded px-2 mr-2">1B</span>
              {% endif %}
            </div>
          </div>

          <div class="col-3">
            <strong>{{ nuts3 }}</strong>
            <div>
              <i class="fal fa-users fa-fw mr-2"></i>
              {% if report.nuts3_population %}
                {{ report.nuts3_population|intcomma }}
              {% else %}
                <span class="question-number bg-dark text-light rounded px-2 mr-2">2A</span>
              {% endif %}
            </div>
            <div>
              <i class="fal fa-ruler-combined fa-fw mr-2"></i>
              {% if report.nuts3_size %}
                {{ report.nuts3_size|intcomma }} km<sup>2</sup>
              {% else %}
                <span class="question-number bg-dark text-light rounded px-2 mr-2">2B</span>
              {% endif %}
            </div>
          </div>

          <div class="col-3">
            <strong>{{ nuts2 }}</strong>
            <div>
              <i class="fal fa-users fa-fw mr-2"></i>
              {% if report.nuts2_population %}
                {{ report.nuts2_population|intcomma }}
              {% else %}
                <span class="question-number bg-dark text-light rounded px-2 mr-2">3A</span>
              {% endif %}
            </div>
            <div>
              <i class="fal fa-ruler-combined fa-fw mr-2"></i>
              {% if report.nuts2_size %}
                {{ report.nuts2_size|intcomma }} km<sup>2</sup>
              {% else %}
                <span class="question-number bg-dark text-light rounded px-2 mr-2">3B</span>
              {% endif %}
            </div>
          </div>

          <div class="col-3">
            <strong>{{ country }}</strong>
            <div>
              <i class="fal fa-users fa-fw mr-2"></i>
              {% if report.country_population %}
                {{ report.country_population|intcomma }}
              {% else %}
                <span class="question-number bg-dark text-light rounded px-2 mr-2">4A</span>
              {% endif %}
            </div>
            <div>
              <i class="fal fa-ruler-combined fa-fw mr-2"></i>
              {% if report.country_size %}
                {{ report.country_size|intcomma }} km<sup>2</sup>
              {% else %}
                <span class="question-number bg-dark text-light rounded px-2 mr-2">4B</span>
              {% endif %}
            </div>
          </div>
        </div>
      </section>

      <section>
        <h2>Population of {{ space }}</h2>
        {% if report.population_dataset %}
          {% if report.population_dataset.is_part_of %}
            {% if report.population_dataset.is_part_of.data.all %}
              <iframe class="libraryitem mb-4" src="/library/preview/{{ report.population_dataset.is_part_of.id }}/" onload="resizeIframe(this)"></iframe>
            {% elif report.population_dataset.is_part_of.type.name == "Image" %}
              <img src="{{ report.population_dataset.is_part_of.image.url }}" class="img-fluid">
              <p><a href="{% url 'cityloops:library_item' report.population_dataset.is_part_of.id %}">Data source</a></p>
            {% elif report.population_dataset.type.name == "Image" %}
              <img src="{{ report.population_dataset.image.url }}" class="img-fluid">
              <p><a href="{% url 'cityloops:library_item' report.population_dataset.is_part_of.id %}">Data source</a></p>
            {% endif %}
          {% else %}
            {% if report.population_dataset.type.name == "Image" %}
              <img src="{{ report.population_dataset.image.url }}" class="img-fluid">
              <p><a href="{% url 'cityloops:library_item' report.population_dataset.id %}">Data source</a></p>
            {% elif report.population_dataset.data.all %}
              <iframe class="libraryitem mb-4" src="/library/preview/{{ report.population_dataset.id }}/" onload="resizeIframe(this)"></iframe>
            {% endif %}
          {% endif %}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">5A</span>
        {% endif %}

        {% if report.population_description_html %}
          {{ report.population_description_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">5B</span>
        {% endif %}
      </section>

      <section>
        <h2>Land use</h2>

        {% if report.land_use_dataset %}
          {% if report.land_use_dataset.type.name == "Image" %}
            <img src="{{ report.land_use_dataset.image.url }}" class="img-fluid">

            {% if space.slug == "porto" %}
              <div class="border border-top-0 rounded-bottom p-3">
                <div class="row">
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #e41a1c"></i></span> Historic Space</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #377eb8"></i></span> Urbanised Space</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #4daf4a"></i></span> Green Space</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #984ea3"></i></span> Industrial Space</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ff7f00"></i></span> Special Use Space - Equipment and Infrastructure</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ffff33"></i></span> Not Assigned</li>
                    </ul>
                  </div>
                </div>
              </div>
            {% elif space.slug == "mikkeli" %}
              <div class="border border-top-0 rounded-bottom p-3">
                <div class="row">
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #e41a1c"></i></span> Agricultural areas</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ff7f00"></i></span> Artificial surfaces</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #4daf4a"></i></span> Forests</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #984ea3"></i></span> Roads</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #377eb8"></i></span> Water bodies</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ffff33"></i></span> Wetlands</li>
                    </ul>
                  </div>
                </div>
              </div>
            {% elif space.slug == "apeldoorn" %}
              <div class="border border-top-0 rounded-bottom p-3">
                <div class="row">
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #144d58"></i></span> Agriculture</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #a6cee3"></i></span> Built area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #33a02c"></i></span> Dry natural terrain</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #b2df8a"></i></span> Forest</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #e31a1c"></i></span> Greenhouse horticulture</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #fb9a99"></i></span> Industrial area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ff7f00"></i></span> Main road</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #fdbf6f"></i></span> Railway</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #6a3d9a"></i></span> Recreation</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #cab2d6"></i></span> Semi-built area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #b15928"></i></span> Water</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ffff99"></i></span> Wet natural terrain</li>
                    </ul>
                  </div>
                </div>
              </div>
            {% elif space.slug == "hoje-taastrup" %}
              <div class="border border-top-0 rounded-bottom p-3">
                <div class="row">
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #008000"></i></span> Area for public purposes</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #0000ff"></i></span> Business area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ff0000"></i></span> Center</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ffa500"></i></span> Land area</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #800080"></i></span> Residential area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #a52a2a"></i></span> Mixed housing and business</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ffc0cb"></i></span> Technical facilities</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #008080"></i></span> Recreational area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #800000"></i></span> Vacation home area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #000080"></i></span> Other</li>
                    </ul>
                  </div>
                </div>
              </div>
            {% elif space.slug == "roskilde" %}
              <div class="border border-top-0 rounded-bottom p-3">
                <div class="row">
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #008000"></i></span> Area for public purposes</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #0000ff"></i></span> Business area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ff0000"></i></span> Center</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ffa500"></i></span> Land area</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #800080"></i></span> Residential area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #a52a2a"></i></span> Mixed housing and business</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ffc0cb"></i></span> Technical facilities</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #008080"></i></span> Recreational area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #800000"></i></span> Vacation home area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #000080"></i></span> Other</li>
                    </ul>
                  </div>
                </div>
              </div>
            {% elif space.slug == "bodo" %}
              <div class="border border-top-0 rounded-bottom p-3">
                <div class="row">
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #144d58"></i></span> Airport</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ffff99"></i></span> Alpine Slopes</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #e31a1c"></i></span> Cemetery</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #b2df8a"></i></span> Cropland</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #33a02c"></i></span> Forest</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #fb9a99"></i></span> Glacier</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #ff7f00"></i></span> Golfcourse</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #fdbf6f"></i></span> Industrial Area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #80b1d3"></i></span> Lake</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #cab2d6"></i></span> Open Area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #b15928"></i></span> Quarry</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #a6cee3"></i></span> Regulated Lake</li>
                    </ul>
                  </div>
                  <div class="col-4">
                    <ul class="fa-ul mb-0">
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #8dd3c7"></i></span> Riverstream</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #bd3e6e"></i></span> Runway</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #bebada"></i></span> Sports Area</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #fb8072"></i></span> Swamp</li>
                      <li><span class="fa-li"><i class="fas fa-circle" style="color: #6a3d9a"></i></span> Urban Built Up Area</li>
                    </ul>
                  </div>
                </div>
              </div>
            {% endif %}

            {% if report.land_use_dataset.is_part_of %}
              <p><a href="{% url 'cityloops:library_item' report.land_use_dataset.is_part_of.id %}">Data source</a></p>
            {% else %}
              <p><a href="{% url 'cityloops:library_item' report.land_use_dataset.id %}">Data source</a></p>
            {% endif %}
          {% else %}
            <iframe class="libraryitem mb-4" src="/library/preview/{{ report.land_use_dataset.id }}/" onload="resizeIframe(this)"></iframe>
            <p><a href="{% url 'cityloops:library_item' report.land_use_dataset.id %}">Data source</a></p>
          {% endif %}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">6A</span>
        {% endif %}

        {% if report.land_use_description_html %}
          {{ report.land_use_description_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">6B</span>
        {% endif %}
      </section>

      <section id="sector-context">
        <h1>Economic context of {{ space }}</h1>

        <p class="font-italic">
          This section puts into perspective the economic context of {{ space }}. It describes how many people are employed in this sector, as well as who the main actors involved are.
        </p>

        <table class="table border">
          <thead>
            <tr>
              <th></th>
              <th>GDP (monetary value, in {{ currency }})</th>
              <th>Employees</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th>{{ space }}</th>
              <td>
                {% if report.space_gdp %}
                  {{ report.space_gdp|intcomma }}
                {% else %}
                  <span class="question-number bg-dark text-light rounded px-2 mr-2">7A</span>
                {% endif %}
              </td>
              <td>
                {% if report.space_employees %}
                  {{ report.space_employees|intcomma }}
                {% else %}
                  <span class="question-number bg-dark text-light rounded px-2 mr-2">7B</span>
                {% endif %}
              </td>
            </tr>
            <tr>
              <th>{{ nuts3 }}</th>
              <td>
                {% if report.nuts3_gdp %}
                  {{ report.nuts3_gdp|intcomma }}
                {% else %}
                  <span class="question-number bg-dark text-light rounded px-2 mr-2">8A</span>
                {% endif %}
              </td>
              <td>
                {% if report.nuts3_employees %}
                  {{ report.nuts3_employees|intcomma }}
                {% else %}
                  <span class="question-number bg-dark text-light rounded px-2 mr-2">8B</span>
                {% endif %}
              </td>
            </tr>
            <tr>
              <th>{{ nuts2 }}</th>
              <td>
                {% if report.nuts2_gdp %}
                  {{ report.nuts2_gdp|intcomma }}
                {% else %}
                  <span class="question-number bg-dark text-light rounded px-2 mr-2">9A</span>
                {% endif %}
              </td>
              <td>
                {% if report.nuts2_employees %}
                  {{ report.nuts2_employees|intcomma }}
                {% else %}
                  <span class="question-number bg-dark text-light rounded px-2 mr-2">9B</span>
                {% endif %}
              </td>
            </tr>
            <tr>
              <th>{{ country }}</th>
              <td>
                {% if report.country_gdp %}
                  {{ report.country_gdp|intcomma }}
                {% else %}
                  <span class="question-number bg-dark text-light rounded px-2 mr-2">10A</span>
                {% endif %}
              </td>
              <td>
                {% if report.country_employees %}
                  {{ report.country_employees|intcomma }}
                {% else %}
                  <span class="question-number bg-dark text-light rounded px-2 mr-2">10B</span>
                {% endif %}
              </td>
            </tr>
          </tbody>
        </table>

        <h4>The economic activities in {{ space }}</h4>
        {% if report.econ_description_html %}
          {{ report.econ_description_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">11</span>
        {% endif %}
      </section>

      <section id="flows">
        <h1>Material flows in {{ space }}</h1>

        <label>Domestic Extraction</label><br>
        {% if report.domestic_extraction_html %}
          {{ report.domestic_extraction_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">12</span>
        {% endif %}

        <label>Imports & Exports</label><br>
        {% if report.imports_exports_html %}
          {{ report.imports_exports_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">13</span>
        {% endif %}

        <label>Domestic Material Consumption</label><br>
        {% if report.consumption_html %}
          {{ report.consumption_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">14</span>
        {% endif %}

        <label>Waste</label><br>
        {% if report.waste_html %}
          {{ report.waste_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">15</span>
        {% endif %}
      </section>

      <section id="stock">
        <h1>Analysis of Flows and Stocks: Measuring Indicators</h1>

        <label>Material Stock Map</label><br>
        {% if report.stock_map_dataset %}
          {% if report.stock_map_dataset.is_part_of %}
            {% if report.stock_map_dataset.is_part_of.data.all %}
              <iframe class="libraryitem mb-4" src="/library/preview/{{ report.stock_map_dataset.is_part_of.id }}/" onload="resizeIframe(this)"></iframe>
            {% elif report.stock_map_dataset.is_part_of.type.name == "Image" %}
              <img src="{{ report.stock_map_dataset.is_part_of.image.url }}" class="img-fluid">
              <p><a href="{% url 'cityloops:library_item' report.stock_map_dataset.is_part_of.id %}">Data source</a></p>
            {% elif report.stock_map_dataset.type.name == "Image" %}
              <img src="{{ report.stock_map_dataset.image.url }}" class="img-fluid">
              <p><a href="{% url 'cityloops:library_item' report.stock_map_dataset.is_part_of.id %}">Data source</a></p>
            {% endif %}
          {% else %}
            {% if report.stock_map_dataset.type.name == "Image" %}
              <img src="{{ report.stock_map_dataset.image.url }}" class="img-fluid">
              <p>
                {% if report.stock_map_dataset.image.url.description %}{{ report.stock_map_dataset.image.url.get_description }} | {% endif %}
                <a href="{% url 'cityloops:library_item' report.stock_map_dataset.id %}"> Data source</a>
              </p>
            {% elif report.stock_map_dataset.data.all %}
              <iframe class="libraryitem mb-4" src="/library/preview/{{ report.stock_map_dataset.id }}/" onload="resizeIframe(this)"></iframe>
            {% endif %}
          {% endif %}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">16A</span>
        {% endif %}

        <label>Chart with different materials</label><br>
        {% if report.materials_dataset %}
          {% if report.materials_dataset.is_part_of %}
            {% if report.materials_dataset.is_part_of.data.all %}
              <iframe class="libraryitem mb-4" src="/library/preview/{{ report.materials_dataset.is_part_of.id }}/" onload="resizeIframe(this)"></iframe>
            {% elif report.materials_dataset.is_part_of.type.name == "Image" %}
              <img src="{{ report.materials_dataset.is_part_of.image.url }}" class="img-fluid">
              <p>
                {% if report.materials_dataset.is_part_of.image.description %}{{ report.materials_dataset.is_part_of.image.get_description }} | {% endif %}
                <a href="{% url 'cityloops:library_item' report.materials_dataset.is_part_of.id %}">Data source</a>
              </p>
            {% elif report.materials_dataset.type.name == "Image" %}
              <img src="{{ report.materials_dataset.image.url }}" class="img-fluid">
              <p>
                {% if report.materials_dataset.image.description %}{{ report.materials_dataset.image.get_description }} | {% endif %}
                <a href="{% url 'cityloops:library_item' report.materials_dataset.is_part_of.id %}">Data source</a>
              </p>
            {% endif %}
          {% else %}
            {% if report.materials_dataset.type.name == "Image" %}
              <img src="{{ report.materials_dataset.image.url }}" class="img-fluid">
              <p>
                {% if report.materials_dataset.image.description %}{{ report.materials_dataset.image.get_description }} | {% endif %}
                <a href="{% url 'cityloops:library_item' report.materials_dataset.id %}">Data source</a>
              </p>
            {% elif report.materials_dataset.data.all %}
              <iframe class="libraryitem mb-4" src="/library/preview/{{ report.materials_dataset.id }}/" onload="resizeIframe(this)"></iframe>
            {% endif %}
          {% endif %}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">16B</span>
        {% endif %}

        <label>Typologies in {{ space }}</label><br>
        {% if report.typologies_html %}
          {{ report.typologies_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">17</span>
        {% endif %}

        <label>Analysis of Material Stock</label><br>
        {% if report.stock_html %}
          {{ report.stock_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">18</span>
        {% endif %}
      </section>

      <section id="analysis">
        <h1>Analysis of Flows and Stocks: Measuring Indicators</h1>

        <label>Indicator tables</label><br>
        {% if report.indicator_table_html %}
          {{ report.indicator_table_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">19</span>
        {% endif %}

        <label>Indicators that were chosen and their development over time</label><br>
        {% if report.indicators_html %}
          {{ report.indicators_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">20</span>
        {% endif %}
      </section>

      <section id="quality">
        <h1>Data quality assessment</h1>
        <label>Data quality matrix</label><br>
        {% if report.matrix_html %}
          {{ report.matrix_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">21</span>
        {% endif %}

        <label>Data quality matrix</label><br>
        {% if report.quality_html %}
          {{ report.quality_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">22</span>
        {% endif %}
      </section>

      <section id="circularity">
        <h1>Analysis of Data and Indicators: Assessing Circularity</h1>

        <label>Insights on status quo of {{ space }}</label><br>
        {% if report.status_quo_html %}
          {{ report.status_quo_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">24</span>
        {% endif %}

        <label>Recommendations for making {{ space }} more circular</label><br>
        {% if report.recommendations_html %}
          {{ report.recommendations_html|safe }}
        {% else %}
          <span class="question-number bg-dark text-light rounded px-2 mr-2">25</span>
        {% endif %}
      </section>

      <section id="references">
        <h1>References</h1>
        <ul>
          <li><a href="{% url 'cityloops:referencespace' country.id  %}">{{ country }}</a></li>
          <li><a href="{% url 'cityloops:referencespace' nuts2.id  %}">{{ nuts2 }}</a></li>
          <li><a href="{% url 'cityloops:referencespace' nuts3.id  %}">{{ nuts3 }}</a></li>
          {% if report.population_dataset %}
            <li><a href="{% url 'cityloops:library_item' report.population_dataset.id  %}">{{ report.population_dataset }}</a></li>
          {% endif %}
          {% if report.land_use_dataset %}
            <li><a href="{% url 'cityloops:library_item' report.land_use_dataset.id  %}">{{ report.land_use_dataset }}</a></li>
          {% endif %}
          {% if report.actors_dataset %}
            <li><a href="{% url 'cityloops:library_item' report.actors_dataset.id  %}">{{ report.actors_dataset }}</a></li>
          {% endif %}
      </section>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
     integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
     crossorigin=""></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script>
    // table tweaks
    $("table").addClass("table");
    $("span[data-color]").each(function() {
      let span = $(this);
      let color = span.data("color");
      let cell = span.parent();

      cell.addClass("bg-" + color)

    })

    {% if space.geometry %}
      // space
      var space_map = L.map("space-map", {
        attributionControl: false,
        zoomControl: false,
      });

      var space_map_geojson = {{ space.geometry.geojson|safe }};
      var space_map_geojsonlayer = L.geoJSON(space_map_geojson).addTo(space_map);

      L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q", {
        attribution: "Map data &copy; <a href='http://openstreetmap.org'>OpenStreetMap</a> contributors, " +
          "<a href='http://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, " +
          "Imagery © <a href='http://mapbox.com'>Mapbox</a>",
        maxZoom: 18,
        id: "mapbox/light-v10",
        tileSize: 512,
        zoomOffset: -1,
        accessToken: "pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q"
      }).addTo(space_map);

      space_map.scrollWheelZoom.disable();
      space_map.fitBounds(space_map_geojsonlayer.getBounds());
    {% endif %}

    // NUTS3
    var nuts_3_map = L.map("nuts3-map", {
      attributionControl: false,
      zoomControl: false,
    });
    var nuts_3_geojson = {{ nuts3.geometry.geojson|safe }};
    var nuts_3_geojsonlayer = L.geoJSON(nuts_3_geojson).addTo(nuts_3_map);

    L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q", {
      attribution: "Map data &copy; <a href='http://openstreetmap.org'>OpenStreetMap</a> contributors, " +
        "<a href='http://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, " +
        "Imagery © <a href='http://mapbox.com'>Mapbox</a>",
      id: "mapbox/light-v10",
      maxZoom: 18,
      tileSize: 512,
      zoomOffset: -1,
      accessToken: "pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q"
    }).addTo(nuts_3_map);

    nuts_3_map.scrollWheelZoom.disable();
    nuts_3_map.fitBounds(nuts_3_geojsonlayer.getBounds());

    // NUTS2
    var nuts_2_map = L.map("nuts2-map", {
      attributionControl: false,
      zoomControl: false,
    });
    var nuts_2_geojson = {{ nuts2.geometry.geojson|safe }};
    var nuts_2_geojsonlayer = L.geoJSON(nuts_2_geojson).addTo(nuts_2_map);

    L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q", {
      attribution: "Map data &copy; <a href='http://openstreetmap.org'>OpenStreetMap</a> contributors, " +
        "<a href='http://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, " +
        "Imagery © <a href='http://mapbox.com'>Mapbox</a>",
      id: "mapbox/light-v10",
      maxZoom: 18,
      tileSize: 512,
      zoomOffset: -1,
      accessToken: "pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q"
    }).addTo(nuts_2_map);

    nuts_2_map.scrollWheelZoom.disable();
    nuts_2_map.fitBounds(nuts_2_geojsonlayer.getBounds());

    // COUNTRY
    var country_map = L.map("country-map", {
      attributionControl: false,
      zoomControl: false,
    });
    var country_geojson = {{ country.geometry.geojson|safe }};
    var country_geojsonlayer = L.geoJSON(country_geojson).addTo(country_map);

    L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q", {
      attribution: "Map data &copy; <a href='http://openstreetmap.org'>OpenStreetMap</a> contributors, " +
        "<a href='http://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, " +
        "Imagery © <a href='http://mapbox.com'>Mapbox</a>",
      id: "mapbox/light-v10",
      maxZoom: 18,
      tileSize: 512,
      zoomOffset: -1,
      accessToken: "pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q"
    }).addTo(country_map);

    country_map.scrollWheelZoom.disable();

    {% if bounding_box %}
      country_map.fitBounds({{ bounding_box|safe }})
    {% else %}
      country_map.fitBounds(country_geojsonlayer.getBounds());
    {% endif %}

    // function to make iframe the same size as its content
    function resizeIframe(obj) {
      obj.style.height = obj.contentWindow.document.documentElement.scrollHeight + 'px';
    }
  </script>
</body>
</html>
