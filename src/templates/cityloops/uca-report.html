{% load static %}
{% load moc_extras %}
{% load sass_tags %}
{% load humanize %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>{{ space }} {{ sector }} sector-wide circularity assessment report | CityLoops</title>

  <link class="favicon" rel="shortcut icon" sizes="126x126" href="{% static 'img/favicon/favicon.png' %}">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
     integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
     crossorigin=""/>
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-VhBcF/php0Z/P5ZxlxaEx1GwqTQVIBu4G4giRWxTKOCjTxsPFETUDdVL5B6vYvOt" crossorigin="anonymous">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <link href="{% sass_src 'css/main.scss' %}?refresh21-apr" rel="stylesheet" type="text/css" />
  <style>
    @import url(https://fonts.googleapis.com/css?family=Montserrat:400,700&subset=latin);

    body{
      -webkit-print-color-adjust:exact;
    }

    p {
      text-align: justify;
      text-justify: inter-word;
    }

    iframe.libraryitem {
      display: none !important;
    }

    .d-none.d-print-block {
      display: block !important;
    }

    @media all {
      @page {
        size: unset !important;
      }

      body {
        min-width: unset !important;
        background-color: #fff !important;
      }

      img {
        max-width: 100%;
      }

      .page-break-{{ space.slug }}-{{ sector }} {
        page-break-after: always;
      }

      .cover-page {
        page-break-after: always;
        position: relative;
        width: 100vw !important;
        height: 100vh !important;
      }

      .cover-title {
        color: #fff;
        padding: 90px;
        font-weight: bolder;
        text-transform: uppercase;
      }

      .report-title {
        background-color: #004d76;
        font-size: 1.75rem;
        padding: 8px;
        line-height: 3.5rem;
      }

      .city-title {
        background-color: #00b6ed;
        font-size: 2rem;
        padding: 8px;
        line-height: 4rem;
      }

      .cover-image {
        width: 100vw !important;
        height: 100vh !important;
        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;
        object-fit: cover;
      }

      .cityloops-logo {
        width: 15vw;
        position: absolute;
        right: 3vw;
        bottom: 15vw;
      }

      .moc-logo {
        width: 18vw;
        position: absolute;
        right: 10vw;
        bottom: 5vw;
      }

      .cityloops-background {
        background: transparent;
        width: 30vh;
        height: 30vh;
        border: 15vh solid black;
        border-top-color: transparent;
        border-right-color: #fffd;
        border-bottom-color: #fffd;
        border-left-color: transparent;
        position: absolute;
        bottom: 0;
        right: 0;
        z-index: -1;
      }

      .report-content {
        /*padding: 3rem;*/
        width: 100%;
      }

      .context-map {
        height: 150px;
        width: 100%;
        max-width: 150px;
        border-radius: .25rem;
      }

      label {
        font-weight: bold;
        margin-bottom: 0;
      }

      iframe {
        max-width: calc(210mm - 6rem - 2px);
        height: 500px;
      }

      #sankey {
        width: 100%;
      }

      .sankey-link {
        /*fill-opacity: .5 !important;*/
      }

      .table th {
        background-color: #efefef !important;
      }

      .table td.bg-red {
        background-color: #B57272 !important;
      }

      .table td.bg-green {
        background-color: #87C291 !important;
      }

      .table td.bg-orange {
        background-color: #D9946C !important;
      }

      .table td.bg-blue {
        background-color: #b2c3ef !important;
      }

      .table td.bg-yellow {
        background-color: #e6d384 !important;
      }
    }

    h1 {
      font-size: 1.75rem !important;
    }

    h2 {
      font-size: 1.5rem !important;
    }

    h3,
    h4 {
      font-size: 1.25rem !important;
    }
  </style>
</head>

<body>
  <div class="cover-page">
    <div class="cover-title">
      <span class="report-title">UCA report for</span>
      <span class="city-title">{{ space }}</span>
    </div>
    <!-- <img class="cover-image" src="https://cityloops.metabolismofcities.org/media/records/Roskilde_ratusz_mpazdziora.large.jpg"> -->

    <div class="cityloops-background"></div>
    <img class="cityloops-logo" src="https://metabolismofcities.org/media/records/CityLoops_Logo.png">

    <div class="moc-background"></div>
    <img class="moc-logo" src="https://i.imgur.com/ARgcRYc.png">
  </div>

  <div class="report-content">
    <section id="summary">
      <h1>Summary</h1>
    </section>
    <section id="introduction">
      <h1>Summary</h1>
    </section>

    <section id="references">
      <h1>References</h1>
      <ul>
        <li><a href="{% url 'cityloops:referencespace' country.id  %}">{{ country }}</a></li>
        <li><a href="{% url 'cityloops:referencespace' nuts2.id  %}">{{ nuts2 }}</a></li>
        <li><a href="{% url 'cityloops:referencespace' nuts3.id  %}">{{ nuts3 }}</a></li>
        {% if report.population_dataset %}
          <li><a href="{% url 'cityloops:library_item' report.population_dataset.id  %}">{{ report.population_dataset }}</a></li>
        {% endif %}
        {% if report.land_use_dataset %}
          <li><a href="{% url 'cityloops:library_item' report.land_use_dataset.id  %}">{{ report.land_use_dataset }}</a></li>
        {% endif %}
        {% if report.actors_dataset %}
          <li><a href="{% url 'cityloops:library_item' report.actors_dataset.id  %}">{{ report.actors_dataset }}</a></li>
        {% endif %}
      </ul>
    </section>
  </div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
     integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
     crossorigin=""></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script>
    // table tweaks
    $("table").addClass("table");
    $("span[data-color]").each(function() {
      let span = $(this);
      let color = span.data("color");
      let cell = span.parent();

      cell.addClass("bg-" + color)

    })

    {% if space.geometry %}
      // space
      var space_map = L.map("space-map", {
        attributionControl: false,
        zoomControl: false,
      });

      var space_map_geojson = {{ space.geometry.geojson|safe }};
      var space_map_geojsonlayer = L.geoJSON(space_map_geojson).addTo(space_map);

      L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q", {
        attribution: "Map data &copy; <a href='http://openstreetmap.org'>OpenStreetMap</a> contributors, " +
          "<a href='http://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, " +
          "Imagery © <a href='http://mapbox.com'>Mapbox</a>",
        maxZoom: 18,
        id: "mapbox/light-v10",
        tileSize: 512,
        zoomOffset: -1,
        accessToken: "pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q"
      }).addTo(space_map);

      space_map.scrollWheelZoom.disable();
      space_map.fitBounds(space_map_geojsonlayer.getBounds());
    {% endif %}

    // NUTS3
    var nuts_3_map = L.map("nuts3-map", {
      attributionControl: false,
      zoomControl: false,
    });
    var nuts_3_geojson = {{ nuts3.geometry.geojson|safe }};
    var nuts_3_geojsonlayer = L.geoJSON(nuts_3_geojson).addTo(nuts_3_map);

    L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q", {
      attribution: "Map data &copy; <a href='http://openstreetmap.org'>OpenStreetMap</a> contributors, " +
        "<a href='http://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, " +
        "Imagery © <a href='http://mapbox.com'>Mapbox</a>",
      id: "mapbox/light-v10",
      maxZoom: 18,
      tileSize: 512,
      zoomOffset: -1,
      accessToken: "pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q"
    }).addTo(nuts_3_map);

    nuts_3_map.scrollWheelZoom.disable();
    nuts_3_map.fitBounds(nuts_3_geojsonlayer.getBounds());

    // NUTS2
    var nuts_2_map = L.map("nuts2-map", {
      attributionControl: false,
      zoomControl: false,
    });
    var nuts_2_geojson = {{ nuts2.geometry.geojson|safe }};
    var nuts_2_geojsonlayer = L.geoJSON(nuts_2_geojson).addTo(nuts_2_map);

    L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q", {
      attribution: "Map data &copy; <a href='http://openstreetmap.org'>OpenStreetMap</a> contributors, " +
        "<a href='http://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, " +
        "Imagery © <a href='http://mapbox.com'>Mapbox</a>",
      id: "mapbox/light-v10",
      maxZoom: 18,
      tileSize: 512,
      zoomOffset: -1,
      accessToken: "pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q"
    }).addTo(nuts_2_map);

    nuts_2_map.scrollWheelZoom.disable();
    nuts_2_map.fitBounds(nuts_2_geojsonlayer.getBounds());

    // COUNTRY
    var country_map = L.map("country-map", {
      attributionControl: false,
      zoomControl: false,
    });
    var country_geojson = {{ country.geometry.geojson|safe }};
    var country_geojsonlayer = L.geoJSON(country_geojson).addTo(country_map);

    L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q", {
      attribution: "Map data &copy; <a href='http://openstreetmap.org'>OpenStreetMap</a> contributors, " +
        "<a href='http://creativecommons.org/licenses/by-sa/2.0/'>CC-BY-SA</a>, " +
        "Imagery © <a href='http://mapbox.com'>Mapbox</a>",
      id: "mapbox/light-v10",
      maxZoom: 18,
      tileSize: 512,
      zoomOffset: -1,
      accessToken: "pk.eyJ1IjoibWV0YWJvbGlzbW9mY2l0aWVzIiwiYSI6ImNqcHA5YXh6aTAxcmY0Mm8yMGF3MGZjdGcifQ.lVZaiSy76Om31uXLP3hw-Q"
    }).addTo(country_map);

    country_map.scrollWheelZoom.disable();

    {% if bounding_box %}
      country_map.fitBounds({{ bounding_box|safe }})
    {% else %}
      country_map.fitBounds(country_geojsonlayer.getBounds());
    {% endif %}

    // function to make iframe the same size as its content
    function resizeIframe(obj) {
      obj.style.height = obj.contentWindow.document.documentElement.scrollHeight + 'px';
    }
  </script>
</body>
</html>
