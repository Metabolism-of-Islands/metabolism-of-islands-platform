{% extends "_base.html" %}
{% load static %}

{% block css %}
  <style>
    table.indicators-table {
      overflow-x: auto;
    }

    tbody td:not(:first-of-type) {
      border-left: solid 1px #dee2e6;
    }

    th.city {
      white-space: nowrap;
    }

    td.indicator-text {
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      max-width: 300px;
    }

    th.sticky-top {
      top: 0;
    }

    td[data-city] {
      min-width: 110px;
    }

    .filters label {
      margin-bottom: 0;
      font-weight: bold;
    }

    .badge.faded {
      opacity: .1;
    }

    .select2-container--bootstrap4 .select2-results > .select2-results__options {
      max-height: 300px;
    }
  </style>
{% endblock %}

{% block content %}
  <h1>Evaluation plans</h1>

  <div class="filters row">
    <div class="col-md-3">
      <div class="form-group">
        <label for="scales">Scales</label>
        <select id="scales" class="custom-select">
          <option value="all">Show all</option>
          <option value="c">City</option>
          <option value="da">Demonstration action</option>
          <option value="s">Sector</option>
        </select>
      </div>
    </div>
    <div class="col-md-9">
      <div class="form-group">
        <label for="cities">Cities</label>
        <select id="cities" class="custom-select" multiple>
          <option selected value="apeldoorn">Apeldoorn</option>
          <option selected value="bodo">Bodø</option>
          <option selected value="hoje">Høje-Taastrup</option>
          <option selected value="mikkeli">Mikkeli</option>
          <option selected value="porto">Porto</option>
          <option selected value="roskilde">Roskilde</option>
          <option selected value="sevilla">Sevilla</option>
        </select>
      </div>
    </div>
  </div>

  <div class="card card-table mb-4">
    <table class="table indicators-table">
      <thead>
        <tr>
          <th class="sticky-top indicator-text">Indicator</th>
          <th class="sticky-top city" data-city="apeldoorn"><a href="{% url 'cityloops:city_evaluation_plan' 'bodo' %}">Apeldoorn</a></th>
          <th class="sticky-top city" data-city="bodo"><a href="{% url 'cityloops:city_evaluation_plan' 'bodo' %}">Bodø</a></th>
          <th class="sticky-top city" data-city="hoje"><a href="{% url 'cityloops:city_evaluation_plan' 'bodo' %}">Høje-Taastrup</a></th>
          <th class="sticky-top city" data-city="mikkeli"><a href="{% url 'cityloops:city_evaluation_plan' 'bodo' %}">Mikkeli</a></th>
          <th class="sticky-top city" data-city="porto"><a href="{% url 'cityloops:city_evaluation_plan' 'bodo' %}">Porto</a></th>
          <th class="sticky-top city" data-city="roskilde"><a href="{% url 'cityloops:city_evaluation_plan' 'bodo' %}">Roskilde</a></th>
          <th class="sticky-top city" data-city="sevilla"><a href="{% url 'cityloops:city_evaluation_plan' 'bodo' %}">Sevilla</a></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="8" class="ve bg-light font-weight-bold">
            1. Local stakeholder actions
          </td>
        </tr>

        <tr>
          <td class="indicator-text"><a href="{% url 'cityloops:indicators' %}">1. {% lorem 4 w random %}</a></td>
          <td data-city="apeldoorn">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-secondary selection" data-scale="da">DA</a>
          </td>
          <td data-city="bodo">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
          <td data-city="hoje">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-secondary selection" data-scale="c">C</a>
          </td>
          <td data-city="mikkeli">
          </td>
          <td data-city="porto">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
          <td data-city="roskilde">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
          <td data-city="sevilla">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-secondary selection" data-scale="c">C</a>
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
        </tr>

        <tr>
          <td colspan="8" class="ve bg-light font-weight-bold">
            2. Circular business models and behavioural patterns
          </td>
        </tr>

        <tr>
          <td class="indicator-text"><a href="{% url 'cityloops:indicators' %}">2. {% lorem 4 w random %}</a></td>
          <td data-city="apeldoorn">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-secondary selection" data-scale="c">C</a>
          </td>
          <td data-city="bodo">
          </td>
          <td data-city="hoje">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-secondary selection" data-scale="c">C</a>
          </td>
          <td data-city="mikkeli">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
          <td data-city="porto">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-secondary selection" data-scale="da">DA</a>
          </td>
          <td data-city="roskilde">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
          <td data-city="sevilla">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-secondary selection" data-scale="da">DA</a>
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-secondary selection" data-scale="c">C</a>
          </td>
        </tr>

        <tr>
          <td colspan="8" class="ve bg-light font-weight-bold">
            3. Closing material loops and reducing harmful resource use
          </td>
        </tr>

        <tr>
          <td class="indicator-text"><a href="{% url 'cityloops:indicators' %}">3. {% lorem 4 w random %}</a></td>
          <td data-city="apeldoorn">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-secondary selection" data-scale="c">C</a>
          </td>
          <td data-city="bodo">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
          <td data-city="hoje">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-secondary selection" data-scale="da">DA</a>
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
          <td data-city="mikkeli">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
          <td data-city="porto">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-secondary selection" data-scale="c">C</a>
          </td>
          <td data-city="roskilde">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-secondary selection" data-scale="c">C</a>
          </td>
          <td data-city="sevilla">
          </td>
        </tr>

        <tr>
          <td colspan="8" class="ve bg-light font-weight-bold">
            4. Improving human well-being and reducing environmental impacts
          </td>
        </tr>

        <tr>
          <td class="indicator-text"><a href="{% url 'cityloops:indicators' %}">4. {% lorem 4 w random %}</a></td>
          <td data-city="apeldoorn">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-secondary selection" data-scale="c">C</a>
          </td>
          <td data-city="bodo">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
          <td data-city="hoje">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-secondary selection" data-scale="da">DA</a>
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
          <td data-city="mikkeli">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
          </td>
          <td data-city="porto">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-secondary selection" data-scale="c">C</a>
          </td>
          <td data-city="roskilde">
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-cityloops-primary selection" data-scale="s">S</a>
            <a href="{% url 'cityloops:city_evaluation_plan_indicator' 'bodo' 1 %}" class="badge badge-secondary selection" data-scale="c">C</a>
          </td>
          <td data-city="sevilla">
          </td>
        </tr>
      </tbody>
    </table>
  </div>
{% endblock %}

{% block footer %}
  <script>
    // filter by scale
    $("select#scales").change(function() {
      let scale = $("select#scales").val();

      if (scale == "all") {
        $("table [data-scale]").removeClass("faded");
      } else {
        $("table [data-scale]").addClass("faded");
        $("table [data-scale='" + scale + "']").removeClass("faded");
      }

    })

    // filter cities
    $("select#cities").select2({
      closeOnSelect: false,
      theme: "bootstrap4",
    }).on("select2:unselecting", function() {
        $(this).data("unselecting", true);
    }).on("select2:opening", function(e) {
      if ($(this).data("unselecting")) {
        $(this).removeData("unselecting");
        e.preventDefault();
      }
    });


    $("select#cities").change(function() {
      let cities = $("select#cities").val();

      $("table [data-city]").attr("hidden", "hidden");

      $(cities).each(function() {
        $("table [data-city='" + this + "']").removeAttr("hidden");
      })
    })
  </script>
{% endblock %}