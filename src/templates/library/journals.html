{% extends "_base.html" %}
{% block title %}Events List{% endblock %}
{% block page_name %}journals{% endblock %}

{% block content %}
  <h1>{{ article.title }}</h1>

  <p>
    {{ article.content|safe }}
  </p>

  <section id="journal-list">
    <input type="text" class="form-control search mb-4" placeholder="Search by journal name...">

    <div class="row list">
      {% for each in list %}
      <div class="col-md-6 col-xl-4 single-journal mb-4">
        <a class="card btn-card" href="{{ each.get_absolute_url }}">
          <div class="card-body row">
            {% if each.image %}
              <div class="col col-cover">
                <img src="{{ each.image.url }}" alt="">
              </div>
            {% endif %}
            <div class="col">
              <h5 class="journal-name">{{ each }}</h5>
              <p>{{ each.publications.count }} articles</p>
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>

    <div class="card no-results">
      <div class="card-body text-center">
        <h2 class="my-4"><i class="fad fa-search"></i> No journals found</h2>
        <button class="btn btn-lg btn-primary clear-filter my-4">Show all journals</button>
      </div>
    </div>
  </section>

{% endblock %}

{% block footer %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
<script>
  var listOptions = {
      valueNames: ["journal-name"]
  };

  var journalList = new List("journal-list", listOptions);

  // update contact count when searching by name
  journalList.on("searchComplete", function(){
    checkCount();
  });

  // function to check the number of matches
  function checkCount() {
    var count = $("#journal-list .single-journal:visible").length;
    if (count == 0) {
      $(".no-results").addClass("visible");
    } else {
      $(".no-results").removeClass("visible");
    }
  }

  // make dropdowns work as filters
  $(".filters select").change(function() {
    runAllFilters()
  });

  // clear search and filters
  function resetSearchFilters() {
    journalList.search();
    $("input.search").val("");
  }

  $(".clear-filter").click(function() {
    resetSearchFilters();
    checkCount();
  })

  // reset all filters on page load
  resetSearchFilters()
</script>
{% endblock %}
